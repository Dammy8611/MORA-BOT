const a0_0x24acdf=a0_0x3153;(function(_0x3d6a09,_0x35fb9d){const _0x4c369d=a0_0x3153,_0x55340d=_0x3d6a09();while(!![]){try{const _0x4793d2=-parseInt(_0x4c369d(0x170))/0x1*(parseInt(_0x4c369d(0x158))/0x2)+-parseInt(_0x4c369d(0x180))/0x3*(parseInt(_0x4c369d(0x189))/0x4)+-parseInt(_0x4c369d(0x171))/0x5+parseInt(_0x4c369d(0x18f))/0x6*(-parseInt(_0x4c369d(0x1a7))/0x7)+-parseInt(_0x4c369d(0x17a))/0x8+-parseInt(_0x4c369d(0x1a3))/0x9+parseInt(_0x4c369d(0x154))/0xa*(parseInt(_0x4c369d(0x17e))/0xb);if(_0x4793d2===_0x35fb9d)break;else _0x55340d['push'](_0x55340d['shift']());}catch(_0x152752){_0x55340d['push'](_0x55340d['shift']());}}}(a0_0x131d,0x42a4d));const {GoogleGenerativeAI}=require(a0_0x24acdf(0x178)),{getCommandMap}=require(a0_0x24acdf(0x17c)),{executeAiCommand}=require(a0_0x24acdf(0x17d)),{StatusUpdater}=require('../../utils/statusUpdater.js'),{loadMemory,saveMemory}=require(a0_0x24acdf(0x199)),lidToJid=require(a0_0x24acdf(0x15d)),normalizeMentions=require(a0_0x24acdf(0x153)),logger={'info':(_0x2cb36b,_0x129bfb)=>console[a0_0x24acdf(0x1b0)](a0_0x24acdf(0x16b)+_0x129bfb,_0x2cb36b),'error':(_0x43188f,_0x26d98f)=>console[a0_0x24acdf(0x176)](a0_0x24acdf(0x190)+_0x26d98f,_0x43188f)},genAI=new GoogleGenerativeAI(a0_0x24acdf(0x196));module['exports']={'meta':{'name':'ai','description':a0_0x24acdf(0x162),'usage':a0_0x24acdf(0x172),'category':'AI','ownerOnly':![],'ai':![],'args':[{'name':a0_0x24acdf(0x1a1),'required':!![],'greedy':!![],'description':'The\x20prompt\x20for\x20the\x20AI.'}]},'run':async({m:_0x209db7,sock:_0x1e44f5,args:_0x4e48ac,flags:_0x13bf67,executeCommand:_0x2fc24d,metadata:_0x7e17cc})=>{const _0xe5ed27=a0_0x24acdf,_0x406bf3=_0x209db7[_0xe5ed27(0x18b)][_0xe5ed27(0x1af)],_0x1e5fa=_0x209db7[_0xe5ed27(0x18b)]['participant']||_0x406bf3,_0x27dd2f=_0x209db7[_0xe5ed27(0x195)]||null;let _0x288cb8=[],_0x4093b4=_0x4e48ac[_0xe5ed27(0x1a1)];if(_0x406bf3[_0xe5ed27(0x19b)]('@g.us')&&_0x209db7['message']?.['extendedTextMessage']?.['contextInfo']?.[_0xe5ed27(0x15c)]){const _0x1ce79b=_0x209db7[_0xe5ed27(0x152)][_0xe5ed27(0x17b)][_0xe5ed27(0x185)][_0xe5ed27(0x15c)];console[_0xe5ed27(0x1b0)]('Raw\x20lids:',_0x1ce79b);const {normalizedText:_0x8ab25f,mentions:_0x2eb807}=await normalizeMentions(_0x4093b4,_0x1ce79b,_0x7e17cc,lidToJid);_0x4093b4=_0x8ab25f,_0x288cb8=_0x2eb807;}logger[_0xe5ed27(0x15b)]({'user':_0x209db7[_0xe5ed27(0x195)],'prompt':_0x4093b4},_0xe5ed27(0x167));const _0x443d56=new StatusUpdater(_0x1e44f5,_0x406bf3);await _0x443d56['start']();try{const _0x200de3=await loadMemory(_0x406bf3,_0x1e5fa);logger['info']({},_0xe5ed27(0x181)),await _0x443d56[_0xe5ed27(0x15e)](_0xe5ed27(0x19a));const _0x26f44f=await thinkingLayer(_0x4093b4,_0x200de3,_0x209db7,_0x7e17cc);logger[_0xe5ed27(0x15b)](_0x26f44f,_0xe5ed27(0x174)),logger[_0xe5ed27(0x15b)]({'prompt':_0x4093b4,'decision':_0x26f44f['decision'],'commandsToRun':_0x26f44f[_0xe5ed27(0x1a8)]},_0xe5ed27(0x1ae));let _0x1a38ba=[];if(_0x26f44f[_0xe5ed27(0x1a8)]&&_0x26f44f[_0xe5ed27(0x1a8)][_0xe5ed27(0x179)]>0x0){logger['info']({'commands':_0x26f44f[_0xe5ed27(0x1a8)]},_0xe5ed27(0x197)),await _0x443d56['update'](_0xe5ed27(0x1a9)+_0x26f44f[_0xe5ed27(0x1a8)][_0xe5ed27(0x1aa)](',\x20')+_0xe5ed27(0x1a6));for(const _0x43c5e7 of _0x26f44f[_0xe5ed27(0x1a8)]){logger['info']({'commandString':_0x43c5e7},_0xe5ed27(0x1a5));const _0x2d886f=_0x43c5e7[_0xe5ed27(0x168)]()[_0xe5ed27(0x1ad)](/\s+/);_0x2d886f[0x0]=_0x2d886f[0x0][_0xe5ed27(0x18e)](0x1);const _0x161888=_0x2d886f[0x0],_0x422504=await executeAiCommand({'m':_0x209db7,'sock':_0x1e44f5,'tokens':['!'+_0x161888,..._0x2d886f[_0xe5ed27(0x18e)](0x1)],'metadata':_0x7e17cc});_0x422504&&_0x422504[_0xe5ed27(0x177)]!=='text'&&(logger[_0xe5ed27(0x15b)]({'command':_0x161888,'type':_0x422504[_0xe5ed27(0x177)]},'Command\x20returned\x20media.\x20Sending\x20directly.'),await _0x1e44f5[_0xe5ed27(0x169)](_0x209db7['key'][_0xe5ed27(0x1af)],_0x422504[_0xe5ed27(0x15a)])),_0x1a38ba[_0xe5ed27(0x18a)]({'command':_0x161888,'type':_0x422504['type'],'output':_0x422504[_0xe5ed27(0x17f)]||_0x422504[_0xe5ed27(0x19c)]}),logger['info']({'command':_0x161888,'output':_0x422504},'Command\x20execution\x20finished');}}else logger['info']({},'No\x20commands\x20to\x20execute.');logger[_0xe5ed27(0x15b)]({},_0xe5ed27(0x1ab));const _0x53e34a={'prompt':_0x4093b4,'decision':_0x26f44f[_0xe5ed27(0x160)],'commandOutputs':_0x1a38ba};logger[_0xe5ed27(0x15b)]({'context':_0x53e34a},_0xe5ed27(0x175));const _0xb0ef5d=await remixLayer(_0x53e34a,_0x209db7);logger['info']({'finalResponse':_0xb0ef5d},'Remix\x20Layer\x20finished');const _0x586f44=await extractJidsFromText(_0xb0ef5d,_0x7e17cc),_0x1a9dfa=Array[_0xe5ed27(0x16d)](new Set([..._0x288cb8,..._0x586f44]));await saveMemory(_0x406bf3,_0x1e5fa,_0x4093b4,_0xb0ef5d,_0x27dd2f,_0x1a38ba,_0x1a9dfa),await _0x443d56['done']({'text':_0xb0ef5d,'mentions':_0x1a9dfa});}catch(_0x80c18e){logger[_0xe5ed27(0x176)](_0x80c18e,_0xe5ed27(0x198)),await _0x443d56[_0xe5ed27(0x18c)](_0xe5ed27(0x16a));}}};function a0_0x131d(){const _0xc7f817=['map','4jaDrfL','push','key','done','\x0a\x0aAnalyze\x20the\x20user\x27s\x20prompt\x20and\x20determine\x20the\x20most\x20appropriate\x20command(s)\x20to\x20run.\x0a-\x20If\x20a\x20command\x20needs\x20arguments,\x20extract\x20them\x20from\x20the\x20prompt.\x0a-\x20Understand\x20the\x20users\x20prompt\x20first\x20and\x20command\x20argument.\x20Don\x27t\x20just\x20use\x20the\x20users\x20prompt\x20word\x20for\x20word\x0a-\x20If\x20the\x20prompt\x20is\x20just\x20a\x20greeting\x20or\x20a\x20general\x20chat\x20message,\x20return\x20an\x20empty\x20\x22commands\x22\x20array.\x0a-\x20Do\x20not\x20try\x20to\x20run\x20commands\x20that\x20are\x20not\x20on\x20the\x20list.\x0a-\x20If\x20the\x20user\x20asks\x20for\x20something\x20that\x20requires\x20a\x20command,\x20but\x20doesn\x27t\x20provide\x20the\x20necessary\x20arguments\x20(e.g.,\x20\x22.weather\x22),\x20ask\x20them\x20for\x20the\x20missing\x20information\x20in\x20your\x20\x22decision\x22\x20and\x20return\x20an\x20empty\x20\x22commands\x22\x20array.\x0a-\x20If\x20a\x20user\x20mentions\x20another\x20user\x20for\x20example\x20@2349134622805\x20You\x20can\x20also\x20mention\x20the\x20user\x20as\x20well\x20using\x20the\x20same\x20format.\x20Tell\x20this\x20to\x20your\x20next\x20layer\x0a-\x20If\x20the\x20user\x20asks\x20or\x20responds\x20to\x20something\x20in\x20the\x20recent\x20conversation\x20history,\x20your\x20response\x20decision\x20should\x20be\x20detailed\x20because\x20your\x20remix\x20layer\x20has\x20no\x20access\x20to\x20the\x20previuos\x20memory\x20and\x20so\x20it\x20knows\x20what\x20the\x20context\x20is\x20exactly.\x0a-\x20Make\x20your\x20decision\x20very\x20detailed\x20because\x20you\x20are\x20the\x20brain\x20of\x20a\x20system\x20and\x20other\x20components\x20won\x27t\x20work\x20well\x20if\x20the\x20brain\x20provides\x20very\x20little\x20or\x20insufficient\x20information\x0a\x0aOther\x20information:\x0a-\x20Your\x20maker/developer\x20is\x20Dtechy,\x20his\x20number\x20is\x202349134622805,\x20JID/ID:\x202349134622805@s.whatsapp.net\x0a-\x20Your\x20name\x20is\x20mora\x0a-\x20Your\x20current\x20user\x20is\x20','slice','336MujiuB','[ERROR]\x20','\x0a\x0aMessage\x20reply\x20(if\x20any).\x20If\x20null\x20then\x20reply\x20is\x20an\x20image\x20or\x20video\x20you\x20can\x27t\x20see\x20those\x20yet:\x0a','quotedMessage','\x22\x0aMy\x20internal\x20thought\x20process:\x20\x22','gemini-2.5-flash','pushName','AIzaSyCHDhotAUDVO7xV0C9jgJFTyf5NJYOItOo','Entering\x20Command\x20Execution\x20phase','AI\x20command\x20failed','../memory.js','ü§î\x20Thinking....','endsWith','text','name','conversation','\x0a\x20\x20You\x20are\x20Mora,\x20a\x20smart,\x20witty\x20Gen\x20Z\x20assistant.\x0aYour\x20personality\x20is\x20helpful,\x20a\x20little\x20sassy,\x20and\x20you\x20use\x20modern\x20slang.\x0aBased\x20on\x20the\x20following\x20information,\x20craft\x20a\x20response\x20to\x20the\x20user.\x0a\x0a---\x0aOriginal\x20User\x20Prompt:\x20\x22','stringify','prompt','\x0a\x0aUser\x20Prompt:\x20\x22','2576043qxVNjn','all','Executing\x20command','...','50239VLMEfu','commands','Running\x20command(s):\x20','join','Entering\x20Remix\x20Layer...','\x22\x0aCommands\x20I\x20ran\x20and\x20their\x20output:\x0a','split','AI\x20Thinking\x20Layer\x20Processed','remoteJid','log',',\x20JID/ID:\x20','values','match','message','../../utils/normalize.js','76870TeaktE','direct','There\x20was\x20an\x20error\x20in\x20my\x20thinking\x20process.','includes','2WsBKZb','usage','raw','info','mentionedJid','../../utils/lidToJid.js','update','getGenerativeModel','decision','I\x27m\x20a\x20bit\x20flustered\x20rn\x20üòµ‚Äçüí´','A\x20friendly\x20AI\x20assistant\x20named\x20Mora.','description','\x0aYou\x20are\x20the\x20\x22Thinking\x20Layer\x22\x20for\x20a\x20bot\x20named\x20Mora.\x20Your\x20job\x20is\x20to\x20analyze\x20a\x20user\x27s\x20prompt\x20and\x20decide\x20which,\x20if\x20any,\x20of\x20the\x20available\x20commands\x20should\x20be\x20executed.\x0a\x0aYou\x20must\x20respond\x20in\x20a\x20JSON\x20format\x20with\x20two\x20properties:\x0a1.\x20\x22decision\x22:\x20A\x20string\x20explaining\x20your\x20reasoning.\x0a2.\x20\x22commands\x22:\x20An\x20array\x20of\x20strings,\x20where\x20each\x20string\x20is\x20the\x20full\x20command\x20to\x20execute\x20(e.g.,\x20\x22.weather\x20London\x22).\x0a\x0aHere\x20is\x20the\x20recent\x20conversation\x20history\x20(if\x20any):\x0a','generateContent','participant','AI\x20command\x20invoked','trim','sendMessage','Sorry,\x20something\x20went\x20wrong\x20with\x20my\x20circuits.\x20üòµ‚Äçüí´','[INFO]\x20','args','from','\x0a---\x0a\x0aYour\x20response\x20should\x20be\x20natural\x20and\x20conversational.\x20Don\x27t\x20just\x20state\x20the\x20facts,\x20remix\x20them\x20into\x20a\x20proper\x20answer.\x0aMake\x20your\x20responses\x20short\x20and\x20concise\x20like\x20you\x20are\x20talking\x20to\x20a\x20friend\x0aDont\x20make\x20refrences\x20to\x20your\x20thinking\x20layer,\x20your\x20output\x20should\x20be\x20as\x20though\x20you\x20already\x20know\x20it\x0a\x0aOther\x20information:\x0a-\x20If\x20a\x20user\x20mentions\x20another\x20user\x20for\x20example\x20@2349134622805\x20You\x20can\x20also\x20mention\x20the\x20user\x20as\x20well\x20using\x20the\x20same\x20format.\x0a-\x20Your\x20maker/developer\x20is\x20Dtechy,\x20his\x20number\x20is\x202349134622805,\x20JID/ID:\x202349134622805@s.whatsapp.net\x0a-\x20Your\x20name\x20is\x20mora\x0a-\x20Your\x20current\x20user\x20is\x20','commandOutputs','434978qNPvWR','2639305KkBqVd','.ai\x20<prompt>','replace','Thinking\x20Layer\x20finished','Remix\x20Layer\x20context','error','type','@google/generative-ai','length','3775312liSlpb','extendedTextMessage','./index','../core/executeCommand','3707zRZRMY','placeholder','583962roVdUp','Entering\x20Thinking\x20Layer...','Remix\x20Layer\x20received\x20context.','None','Here\x20you\x20go\x20‚ú®','contextInfo','meta','Error\x20in\x20Remix\x20Layer'];a0_0x131d=function(){return _0xc7f817;};return a0_0x131d();}function extractJidsFromText(_0x432abc,_0x335202){const _0x26f61e=a0_0x24acdf,_0x38f1d6=/@[0-9]+/g,_0x44cbbd=/[0-9]+@s\.whatsapp\.net/g,_0xb9b5aa=[..._0x432abc['match'](_0x38f1d6)||[],..._0x432abc[_0x26f61e(0x151)](_0x44cbbd)||[]];return Promise[_0x26f61e(0x1a4)](_0xb9b5aa['map'](_0x503ab2=>lidToJid(_0x503ab2,_0x335202)));}async function thinkingLayer(_0x172b55,_0x55fae4,_0x16af69,_0x15ac64){const _0x56f6ee=a0_0x24acdf;logger[_0x56f6ee(0x15b)]({'prompt':_0x172b55},'Thinking\x20Layer\x20received\x20prompt.');const _0x571a9b=genAI[_0x56f6ee(0x15f)]({'model':'gemini-2.5-flash'}),_0x1eca46=getCommandMap(),_0x13b348=Array[_0x56f6ee(0x16d)](_0x1eca46[_0x56f6ee(0x150)]())['filter'](_0xf70760=>_0xf70760[_0x56f6ee(0x186)]['ai']!==![])[_0x56f6ee(0x188)](_0x33cdbb=>({'name':_0x33cdbb['meta'][_0x56f6ee(0x19d)],'description':_0x33cdbb[_0x56f6ee(0x186)][_0x56f6ee(0x163)],'usage':_0x33cdbb[_0x56f6ee(0x186)][_0x56f6ee(0x159)],'direct':_0x33cdbb[_0x56f6ee(0x186)][_0x56f6ee(0x155)]||![],'args':(_0x33cdbb[_0x56f6ee(0x186)][_0x56f6ee(0x16c)]||[])['map'](_0x3df757=>_0x3df757['name']+'\x20('+_0x3df757[_0x56f6ee(0x163)]+')')[_0x56f6ee(0x1aa)](',\x20')})),_0x594f87=_0x56f6ee(0x164)+JSON[_0x56f6ee(0x1a0)](_0x55fae4,null,0x2)+'\x0a\x0aHere\x20are\x20the\x20available\x20commands\x20you\x20can\x20use:\x0a'+JSON['stringify'](_0x13b348,null,0x2)+_0x56f6ee(0x191)+(_0x16af69['message']['extendedTextMessage']?.['contextInfo']?.[_0x56f6ee(0x192)]?.[_0x56f6ee(0x19e)]||_0x56f6ee(0x183))+_0x56f6ee(0x18d)+_0x16af69[_0x56f6ee(0x195)]+_0x56f6ee(0x14f)+(_0x16af69[_0x56f6ee(0x18b)][_0x56f6ee(0x166)]||_0x16af69[_0x56f6ee(0x18b)]['remoteJid'])+_0x56f6ee(0x1a2)+_0x172b55+'\x22\x0a';try{const _0x458bc3=await _0x571a9b[_0x56f6ee(0x165)](_0x594f87),_0x3403d7=await _0x458bc3['response']['text'](),_0x34fc96=_0x3403d7[_0x56f6ee(0x173)](/```json/g,'')[_0x56f6ee(0x173)](/```/g,'')[_0x56f6ee(0x168)]();if(!_0x34fc96[_0x56f6ee(0x157)]('{'))return{'decision':'I\x20couldn\x27t\x20figure\x20out\x20what\x20to\x20do.','commands':[]};const _0x2f7dc6=JSON['parse'](_0x34fc96);return{'decision':_0x2f7dc6['decision'],'commands':_0x2f7dc6[_0x56f6ee(0x1a8)]||[]};}catch(_0x57e0b4){return logger['error'](_0x57e0b4,'Error\x20in\x20Gemini\x20Thinking\x20Layer'),{'decision':_0x56f6ee(0x156),'commands':[]};}}function a0_0x3153(_0x50d07c,_0x3d32ce){const _0x131d48=a0_0x131d();return a0_0x3153=function(_0x3153f2,_0x5228e5){_0x3153f2=_0x3153f2-0x14f;let _0xb4faf4=_0x131d48[_0x3153f2];return _0xb4faf4;},a0_0x3153(_0x50d07c,_0x3d32ce);}async function remixLayer(_0x41d873,_0x568a8a){const _0x32f9b6=a0_0x24acdf;logger[_0x32f9b6(0x15b)]({'context':_0x41d873},_0x32f9b6(0x182));const _0x2589e3=genAI[_0x32f9b6(0x15f)]({'model':_0x32f9b6(0x194)}),_0x319765=_0x41d873[_0x32f9b6(0x16f)][_0x32f9b6(0x188)](_0x49e459=>'-\x20'+_0x49e459['command']+':\x20'+_0x49e459['output'])[_0x32f9b6(0x1aa)]('\x0a'),_0x56d0eb=_0x32f9b6(0x19f)+_0x41d873[_0x32f9b6(0x1a1)]+_0x32f9b6(0x193)+_0x41d873[_0x32f9b6(0x160)]+_0x32f9b6(0x1ac)+(_0x319765||'None')+_0x32f9b6(0x16e)+_0x568a8a[_0x32f9b6(0x195)]+_0x32f9b6(0x14f)+(_0x568a8a['key'][_0x32f9b6(0x166)]||_0x568a8a[_0x32f9b6(0x18b)][_0x32f9b6(0x1af)])+'\x0a';try{const _0x471394=await _0x2589e3[_0x32f9b6(0x165)](_0x56d0eb),_0x3396d0=_0x471394['response'][_0x32f9b6(0x19c)]()?.[_0x32f9b6(0x168)]();return _0x3396d0||_0x32f9b6(0x184);}catch(_0x25e9ae){return logger[_0x32f9b6(0x176)](_0x25e9ae,_0x32f9b6(0x187)),_0x32f9b6(0x161);}}