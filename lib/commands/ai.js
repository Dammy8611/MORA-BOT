const a0_0xfd551e=a0_0x4d94;function a0_0x4d94(_0x355913,_0x1134fd){const _0x70ed34=a0_0x70ed();return a0_0x4d94=function(_0x4d94f4,_0x368c1b){_0x4d94f4=_0x4d94f4-0xb0;let _0x16725e=_0x70ed34[_0x4d94f4];return _0x16725e;},a0_0x4d94(_0x355913,_0x1134fd);}(function(_0x461f7a,_0x56822e){const _0x484071=a0_0x4d94,_0x3c33c9=_0x461f7a();while(!![]){try{const _0x412687=-parseInt(_0x484071(0xc4))/0x1*(-parseInt(_0x484071(0x111))/0x2)+parseInt(_0x484071(0xe2))/0x3*(parseInt(_0x484071(0xf8))/0x4)+-parseInt(_0x484071(0x100))/0x5+-parseInt(_0x484071(0xf4))/0x6*(-parseInt(_0x484071(0x10b))/0x7)+parseInt(_0x484071(0x10a))/0x8+-parseInt(_0x484071(0xb5))/0x9*(-parseInt(_0x484071(0x10f))/0xa)+-parseInt(_0x484071(0xfc))/0xb*(parseInt(_0x484071(0xce))/0xc);if(_0x412687===_0x56822e)break;else _0x3c33c9['push'](_0x3c33c9['shift']());}catch(_0x56657a){_0x3c33c9['push'](_0x3c33c9['shift']());}}}(a0_0x70ed,0x860da));const {GoogleGenerativeAI}=require(a0_0xfd551e(0xfa)),{getCommandMap}=require(a0_0xfd551e(0x10d)),{executeAiCommand}=require('../core/executeCommand'),{StatusUpdater}=require(a0_0xfd551e(0xff)),{loadMemory,saveMemory}=require(a0_0xfd551e(0xb0)),logger={'info':(_0x359697,_0x35cd05)=>console[a0_0xfd551e(0xe9)]('[INFO]\x20'+_0x35cd05,_0x359697),'error':(_0x2f6346,_0x412c60)=>console['error']('[ERROR]\x20'+_0x412c60,_0x2f6346)},genAI=new GoogleGenerativeAI(a0_0xfd551e(0xd6));module[a0_0xfd551e(0xb8)]={'meta':{'name':'ai','description':a0_0xfd551e(0xd3),'usage':a0_0xfd551e(0xcf),'category':'AI','ownerOnly':![],'ai':![],'args':[{'name':'prompt','required':!![],'greedy':!![],'description':a0_0xfd551e(0xf5)}]},'run':async({m:_0x31c3a4,sock:_0x5f030b,args:_0x44b09c,flags:_0x85168b,executeCommand:_0x15e301})=>{const _0x29592b=a0_0xfd551e,_0x4b5804=_0x31c3a4[_0x29592b(0xfe)][_0x29592b(0xe8)],_0x11efa7=_0x31c3a4[_0x29592b(0xfe)][_0x29592b(0xbe)]||_0x4b5804,_0x1b19d9=_0x31c3a4['pushName']||null,_0x3b8d50=_0x44b09c[_0x29592b(0xf6)];logger[_0x29592b(0xc2)]({'user':_0x31c3a4['pushName'],'prompt':_0x3b8d50},_0x29592b(0xd8));const _0x3c4e52=new StatusUpdater(_0x5f030b,_0x4b5804);await _0x3c4e52[_0x29592b(0xe5)]();try{const _0x192042=await loadMemory(_0x4b5804,_0x11efa7);logger[_0x29592b(0xc2)]({},'Entering\x20Thinking\x20Layer...'),await _0x3c4e52[_0x29592b(0xb1)]('ðŸ¤”\x20Thinking....');const _0x21d1db=await thinkingLayer(_0x3b8d50,_0x192042);logger[_0x29592b(0xc2)](_0x21d1db,'Thinking\x20Layer\x20finished'),logger['info']({'prompt':_0x3b8d50,'decision':_0x21d1db[_0x29592b(0xd0)],'commandsToRun':_0x21d1db[_0x29592b(0xf2)]},_0x29592b(0xf7));let _0x2bc90c=[];if(_0x21d1db[_0x29592b(0xf2)]&&_0x21d1db[_0x29592b(0xf2)][_0x29592b(0xfb)]>0x0){logger[_0x29592b(0xc2)]({'commands':_0x21d1db[_0x29592b(0xf2)]},'Entering\x20Command\x20Execution\x20phase'),await _0x3c4e52['update'](_0x29592b(0xb2)+_0x21d1db[_0x29592b(0xf2)]['join'](',\x20')+_0x29592b(0xb6));for(const _0x26a2f9 of _0x21d1db['commands']){logger[_0x29592b(0xc2)]({'commandString':_0x26a2f9},_0x29592b(0x103));const _0x3e4589=_0x26a2f9[_0x29592b(0xdf)]()['split'](/\s+/);_0x3e4589[0x0]=_0x3e4589[0x0][_0x29592b(0x109)](0x1);const _0x546f69=_0x3e4589[0x0],_0xf2d8be=await executeAiCommand({'m':_0x31c3a4,'sock':_0x5f030b,'tokens':['!'+_0x546f69,..._0x3e4589[_0x29592b(0x109)](0x1)]});if(_0xf2d8be&&!_0xf2d8be[_0x29592b(0xc3)]){logger[_0x29592b(0xc2)]({'command':_0x546f69,'content':_0xf2d8be},_0x29592b(0xd4)),await _0x3c4e52[_0x29592b(0xd7)](_0x29592b(0xd7)),await _0x5f030b[_0x29592b(0xf1)](_0x31c3a4['key'][_0x29592b(0xe8)],_0xf2d8be),_0x2bc90c[_0x29592b(0xec)]({'command':_0x546f69,'output':_0x29592b(0xea)+(_0xf2d8be[_0x29592b(0xd1)]?_0x29592b(0xd1):_0x29592b(0xb9))+']','isDirect':!![]});continue;}const _0x40b159=_0xf2d8be?_0xf2d8be[_0x29592b(0xc3)]:_0x29592b(0xe0);_0x2bc90c[_0x29592b(0xec)]({'command':_0x546f69,'output':_0x40b159}),logger[_0x29592b(0xc2)]({'command':_0x546f69,'output':_0x40b159},_0x29592b(0xd9));}}else logger[_0x29592b(0xc2)]({},_0x29592b(0xe4));if(_0x2bc90c['length']>0x0&&_0x2bc90c[_0x29592b(0x104)](_0x122f11=>_0x122f11[_0x29592b(0xf9)])){logger['info']({},_0x29592b(0x10c));return;}logger[_0x29592b(0xc2)]({},_0x29592b(0xe3));const _0x4791d3={'prompt':_0x3b8d50,'decision':_0x21d1db['decision'],'commandOutputs':_0x2bc90c};logger['info']({'context':_0x4791d3},'Remix\x20Layer\x20context');const _0x133eda=await remixLayer(_0x4791d3);logger[_0x29592b(0xc2)]({'finalResponse':_0x133eda},_0x29592b(0xfd)),await saveMemory(_0x4b5804,_0x11efa7,_0x3b8d50,_0x133eda,_0x1b19d9,_0x2bc90c),await _0x3c4e52['done'](_0x133eda);}catch(_0x45dc59){logger[_0x29592b(0x10e)](_0x45dc59,_0x29592b(0xc9)),await _0x3c4e52[_0x29592b(0xd7)]('Sorry,\x20something\x20went\x20wrong\x20with\x20my\x20circuits.\x20ðŸ˜µâ€ðŸ’«');}}};async function thinkingLayer(_0x1ff9d8,_0x58ffaf){const _0x338ddf=a0_0xfd551e;logger[_0x338ddf(0xc2)]({'prompt':_0x1ff9d8},_0x338ddf(0xdb));const _0x3ae3c7=genAI[_0x338ddf(0xbf)]({'model':_0x338ddf(0xd5)}),_0x47f333=getCommandMap(),_0x37745a=Array[_0x338ddf(0xc8)](_0x47f333['values']())['filter'](_0x53d5c7=>_0x53d5c7[_0x338ddf(0xcc)]['ai']!==![])[_0x338ddf(0xf0)](_0x2847c6=>({'name':_0x2847c6['meta'][_0x338ddf(0x106)],'description':_0x2847c6[_0x338ddf(0xcc)][_0x338ddf(0xca)],'usage':_0x2847c6[_0x338ddf(0xcc)][_0x338ddf(0xf3)],'direct':_0x2847c6[_0x338ddf(0xcc)][_0x338ddf(0xed)]||![],'args':(_0x2847c6[_0x338ddf(0xcc)][_0x338ddf(0xc5)]||[])[_0x338ddf(0xf0)](_0x74c3ab=>_0x74c3ab[_0x338ddf(0x106)]+'\x20('+_0x74c3ab[_0x338ddf(0xca)]+')')[_0x338ddf(0xda)](',\x20')}));logger[_0x338ddf(0xc2)]({'count':_0x37745a[_0x338ddf(0xfb)]},_0x338ddf(0xef));const _0x248c10=_0x338ddf(0xcd)+JSON[_0x338ddf(0xb7)](_0x58ffaf,null,0x2)+_0x338ddf(0x110)+JSON[_0x338ddf(0xb7)](_0x37745a,null,0x2)+_0x338ddf(0xc1)+_0x1ff9d8+'\x22\x0a';logger['info'](_0x338ddf(0x107));try{const _0x203809=await _0x3ae3c7['generateContent'](_0x248c10),_0xa3ab7e=await _0x203809[_0x338ddf(0xdd)][_0x338ddf(0xc3)]();logger[_0x338ddf(0xc2)]({'responseText':_0xa3ab7e},_0x338ddf(0xcb));const _0x46ebd2=_0xa3ab7e['replace'](/```json/g,'')[_0x338ddf(0xbd)](/```/g,'')[_0x338ddf(0xdf)]();logger[_0x338ddf(0xc2)]({'cleanedText':_0x46ebd2},_0x338ddf(0x105));if(!_0x46ebd2||!_0x46ebd2[_0x338ddf(0xbc)]('{')||!_0x46ebd2[_0x338ddf(0xbc)]('}'))return logger[_0x338ddf(0x10e)]({'cleanedText':_0x46ebd2},'Invalid\x20or\x20empty\x20Gemini\x20JSON\x20response'),{'decision':'I\x20couldn\x27t\x20figure\x20out\x20what\x20to\x20do\x20from\x20that.','commands':[]};const _0x2ee809=JSON['parse'](_0x46ebd2);logger[_0x338ddf(0xc2)]({'jsonResponse':_0x2ee809},_0x338ddf(0x108));const _0x52a36e={'decision':_0x2ee809['decision'],'commands':_0x2ee809[_0x338ddf(0xf2)]||[]};return logger[_0x338ddf(0xc2)]({'thinkingResult':_0x52a36e},_0x338ddf(0xe1)),_0x52a36e;}catch(_0x4ef296){return logger[_0x338ddf(0x10e)](_0x4ef296,_0x338ddf(0xbb)),{'decision':_0x338ddf(0x102),'commands':[]};}}function a0_0x70ed(){const _0x3020f0=['getGenerativeModel','Error\x20in\x20Gemini\x20Remix\x20Layer','\x0a\x0aAnalyze\x20the\x20user\x27s\x20prompt\x20and\x20determine\x20the\x20most\x20appropriate\x20command(s)\x20to\x20run.\x0a-\x20If\x20a\x20command\x20needs\x20arguments,\x20extract\x20them\x20from\x20the\x20prompt.\x0a-\x20Understand\x20the\x20users\x20prompt\x20first\x20and\x20command\x20argument.\x20Don\x27t\x20just\x20use\x20the\x20users\x20prompt\x20word\x20for\x20word\x0a-\x20If\x20the\x20prompt\x20is\x20just\x20a\x20greeting\x20or\x20a\x20general\x20chat\x20message,\x20return\x20an\x20empty\x20\x22commands\x22\x20array.\x0a-\x20Do\x20not\x20try\x20to\x20run\x20commands\x20that\x20are\x20not\x20on\x20the\x20list.\x0a-\x20If\x20the\x20user\x20asks\x20for\x20something\x20that\x20requires\x20a\x20command,\x20but\x20doesn\x27t\x20provide\x20the\x20necessary\x20arguments\x20(e.g.,\x20\x22.weather\x22),\x20ask\x20them\x20for\x20the\x20missing\x20information\x20in\x20your\x20\x22decision\x22\x20and\x20return\x20an\x20empty\x20\x22commands\x22\x20array.\x0a-\x20If\x20the\x20user\x20asks\x20or\x20responds\x20to\x20something\x20in\x20the\x20recent\x20conversation\x20history,\x20your\x20response\x20decision\x20should\x20be\x20detailed\x20because\x20your\x20remix\x20layer\x20has\x20no\x20access\x20to\x20the\x20previuos\x20memory\x20and\x20so\x20it\x20knows\x20what\x20the\x20context\x20is\x20exactly\x0a\x0aUser\x20Prompt:\x20\x22','info','text','241FdyAwe','args','\x22\x0aCommands\x20I\x20ran\x20and\x20their\x20output:\x0a','\x0a---\x0a\x0aYour\x20response\x20should\x20be\x20natural\x20and\x20conversational.\x20Don\x27t\x20just\x20state\x20the\x20facts,\x20remix\x20them\x20into\x20a\x20proper\x20answer.\x0aMake\x20your\x20responses\x20short\x20and\x20concise\x20like\x20you\x20are\x20talking\x20to\x20a\x20friend\x0aDont\x20make\x20refrences\x20to\x20your\x20thinking\x20layer,\x20your\x20output\x20should\x20be\x20as\x20though\x20you\x20already\x20know\x20it\x0a','from','AI\x20command\x20failed','description','Received\x20response\x20from\x20Gemini','meta','\x0aYou\x20are\x20the\x20\x22Thinking\x20Layer\x22\x20for\x20a\x20bot\x20named\x20Mora.\x20Your\x20job\x20is\x20to\x20analyze\x20a\x20user\x27s\x20prompt\x20and\x20decide\x20which,\x20if\x20any,\x20of\x20the\x20available\x20commands\x20should\x20be\x20executed.\x0a\x0aYou\x20must\x20respond\x20in\x20a\x20JSON\x20format\x20with\x20two\x20properties:\x0a1.\x20\x22decision\x22:\x20A\x20string\x20explaining\x20your\x20reasoning.\x0a2.\x20\x22commands\x22:\x20An\x20array\x20of\x20strings,\x20where\x20each\x20string\x20is\x20the\x20full\x20command\x20to\x20execute\x20(e.g.,\x20\x22.weather\x20London\x22).\x0a\x0aHere\x20is\x20the\x20recent\x20conversation\x20history\x20(if\x20any):\x0a','5127816apVvqU','.ai\x20<prompt>','decision','audio','Received\x20final\x20response\x20from\x20Gemini.','A\x20friendly\x20AI\x20assistant\x20named\x20Mora.','Command\x20returned\x20a\x20file.\x20Sending\x20directly.','gemini-2.5-pro','AIzaSyDO4v1a36TNgunFzm7N-FzT3WYJnwIpbRI','done','AI\x20command\x20invoked','Command\x20execution\x20finished','join','Thinking\x20Layer\x20received\x20prompt.','None','response','Remix\x20layer\x20returned\x20empty\x20text','trim','No\x20textual\x20output.','Returning\x20from\x20Thinking\x20Layer','226047QLAGaR','Entering\x20Remix\x20Layer...','No\x20commands\x20to\x20execute.','start','commandOutputs','I\x27m\x20a\x20bit\x20flustered\x20right\x20now,\x20something\x20went\x20wrong\x20while\x20I\x20was\x20trying\x20to\x20be\x20witty.','remoteJid','log','[Sent\x20a\x20file:\x20','Gotcha,\x20all\x20commands\x20handled.\x20âœ¨','push','direct','\x0a\x20\x20You\x20are\x20Mora,\x20a\x20smart,\x20witty\x20Gen\x20Z\x20assistant.\x0aYour\x20personality\x20is\x20helpful,\x20a\x20little\x20sassy,\x20and\x20you\x20use\x20modern\x20slang.\x0aBased\x20on\x20the\x20following\x20information,\x20craft\x20a\x20response\x20to\x20the\x20user.\x0a\x0a---\x0aOriginal\x20User\x20Prompt:\x20\x22','Generated\x20callable\x20command\x20list\x20for\x20AI','map','sendMessage','commands','usage','2088078fsLAFi','The\x20prompt\x20for\x20the\x20AI.','prompt','AI\x20Thinking\x20Layer\x20Processed','4ERxYLW','isDirect','@google/generative-ai','length','44xwdQMd','Remix\x20Layer\x20finished','key','../../utils/statusUpdater.js','2739640Fsosym','command','There\x20was\x20an\x20error\x20in\x20my\x20thinking\x20process.','Executing\x20command','every','Cleaned\x20Gemini\x20response','name','Sending\x20system\x20prompt\x20to\x20Gemini','Parsed\x20JSON\x20response','slice','4680192UMlcws','14zMUiIm','All\x20commands\x20were\x20handled\x20directly.\x20Skipping\x20Remix\x20Layer.','./index','error','30fBpFiU','\x0a\x0aHere\x20are\x20the\x20available\x20commands\x20you\x20can\x20use:\x0a','6872QsWMuM','../memory.js','update','Running\x20command(s):\x20','Sending\x20final\x20prompt\x20to\x20Gemini\x20for\x20remixing.','output','1865421HBRTES','...','stringify','exports','unknown','filter','Error\x20in\x20Gemini\x20Thinking\x20Layer','includes','replace','participant'];a0_0x70ed=function(){return _0x3020f0;};return a0_0x70ed();}async function remixLayer(_0x1b94cd){const _0x2f9f76=a0_0xfd551e;logger[_0x2f9f76(0xc2)]({'context':_0x1b94cd},'Remix\x20Layer\x20received\x20context.');const _0x1b44f0=genAI[_0x2f9f76(0xbf)]({'model':_0x2f9f76(0xd5)}),_0x3f2f81=_0x1b94cd[_0x2f9f76(0xe6)][_0x2f9f76(0xba)](_0x350aad=>!_0x350aad[_0x2f9f76(0xf9)]);if(_0x3f2f81['length']===0x0&&_0x1b94cd[_0x2f9f76(0xe6)][_0x2f9f76(0xfb)]>0x0)return logger[_0x2f9f76(0xc2)]({},'All\x20command\x20outputs\x20were\x20handled\x20directly.\x20Skipping\x20Remix.'),_0x2f9f76(0xeb);const _0x5ac1a4=_0x2f9f76(0xee)+_0x1b94cd[_0x2f9f76(0xf6)]+'\x22\x0aMy\x20internal\x20thought\x20process:\x20\x22'+_0x1b94cd['decision']+_0x2f9f76(0xc6)+(_0x3f2f81[_0x2f9f76(0xf0)](_0x2ad0c8=>'-\x20'+_0x2ad0c8[_0x2f9f76(0x101)]+':\x20'+_0x2ad0c8[_0x2f9f76(0xb4)])[_0x2f9f76(0xda)]('\x0a')||_0x2f9f76(0xdc))+_0x2f9f76(0xc7);logger[_0x2f9f76(0xc2)](_0x2f9f76(0xb3));try{const _0x551054=await _0x1b44f0['generateContent'](_0x5ac1a4),_0x14b2e1=await _0x551054[_0x2f9f76(0xdd)],_0x4b45be=_0x14b2e1[_0x2f9f76(0xc3)]()?.[_0x2f9f76(0xdf)]();if(!_0x4b45be)return logger[_0x2f9f76(0x10e)]({},_0x2f9f76(0xde)),'Uhh,\x20I\x20spaced\x20out\x20for\x20a\x20second\x20there\x20ðŸ¤¯';return logger[_0x2f9f76(0xc2)]({'response':_0x4b45be},_0x2f9f76(0xd2)),_0x4b45be;}catch(_0x3fb3a6){return logger[_0x2f9f76(0x10e)](_0x3fb3a6,_0x2f9f76(0xc0)),_0x2f9f76(0xe7);}}