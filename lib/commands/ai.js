const a0_0x1213e9=a0_0xc8a3;function a0_0x129e(){const _0x4c5dfd=['\x0a\x0aUser\x20Prompt:\x20\x22','Remix\x20Layer\x20finished','\x0a\x0aMessage\x20reply\x20(if\x20any).\x20If\x20null\x20then\x20reply\x20is\x20an\x20image\x20or\x20video\x20you\x20can\x27t\x20see\x20those\x20yet:\x0a','key','error','slice','\x22\x0aCommands\x20I\x20ran\x20and\x20their\x20output:\x0a','Command\x20returned\x20media.\x20Sending\x20directly.','remoteJid','gemini-2.5-flash','A\x20friendly\x20AI\x20assistant\x20named\x20Mora.','push','\x0a---\x0a\x0aYour\x20response\x20should\x20be\x20natural\x20and\x20conversational.\x20Don\x27t\x20just\x20state\x20the\x20facts,\x20remix\x20them\x20into\x20a\x20proper\x20answer.\x0aMake\x20your\x20responses\x20short\x20and\x20concise\x20like\x20you\x20are\x20talking\x20to\x20a\x20friend\x0aDont\x20make\x20refrences\x20to\x20your\x20thinking\x20layer,\x20your\x20output\x20should\x20be\x20as\x20though\x20you\x20already\x20know\x20it\x0a\x0aOther\x20information:\x0a-\x20If\x20a\x20user\x20mentions\x20another\x20user\x20for\x20example\x20@2349134622805\x20You\x20can\x20also\x20mention\x20the\x20user\x20as\x20well\x20using\x20the\x20same\x20format.\x0a-\x20Your\x20maker/developer\x20is\x20Dtechy,\x20his\x20number\x20is\x202349134622805,\x20JID/ID:\x202349134622805@s.whatsapp.net\x0a-\x20Your\x20name\x20is\x20mora\x0a-\x20Your\x20current\x20user\x20is\x20','Here\x20you\x20go\x20✨','decision','1129048NRrTNP','Raw\x20lids:','participant','replace','generateContent','The\x20prompt\x20for\x20the\x20AI.','description','filter','1906857CjDiUd','getGenerativeModel','match','done','trim','text','Running\x20command(s):\x20','split','meta','pushName','No\x20commands\x20to\x20execute.','...','map','length','@google/generative-ai','commandOutputs','Remix\x20Layer\x20received\x20context.','../../utils/lidToJid.js','../../utils/normalize.js','exports','placeholder','endsWith','10gGVhWF','\x22\x0aMy\x20internal\x20thought\x20process:\x20\x22','response','prompt','Sorry,\x20something\x20went\x20wrong\x20with\x20my\x20circuits.\x20😵‍💫','Entering\x20Remix\x20Layer...','mentionedJid','I\x27m\x20a\x20bit\x20flustered\x20rn\x20😵‍💫','[INFO]\x20','log','Thinking\x20Layer\x20finished','3acXwsW','125604dFplpk','AI\x20command\x20invoked','type','info','all','../core/executeCommand','message','extendedTextMessage','AIzaSyCHDhotAUDVO7xV0C9jgJFTyf5NJYOItOo','Thinking\x20Layer\x20received\x20prompt.','../../utils/statusUpdater.js','update','args','Error\x20in\x20Remix\x20Layer','3159452sIarXA','AI\x20command\x20failed','values','direct','../memory.js','\x0aYou\x20are\x20the\x20\x22Thinking\x20Layer\x22\x20for\x20a\x20bot\x20named\x20Mora.\x20Your\x20job\x20is\x20to\x20analyze\x20a\x20user\x27s\x20prompt\x20and\x20decide\x20which,\x20if\x20any,\x20of\x20the\x20available\x20commands\x20should\x20be\x20executed.\x0a\x0aYou\x20must\x20respond\x20in\x20a\x20JSON\x20format\x20with\x20two\x20properties:\x0a1.\x20\x22decision\x22:\x20A\x20string\x20explaining\x20your\x20reasoning.\x0a2.\x20\x22commands\x22:\x20An\x20array\x20of\x20strings,\x20where\x20each\x20string\x20is\x20the\x20full\x20command\x20to\x20execute\x20(e.g.,\x20\x22.weather\x20London\x22).\x0a\x0aHere\x20is\x20the\x20recent\x20conversation\x20history\x20(if\x20any):\x0a','90Szriid','None','Entering\x20Command\x20Execution\x20phase','output','3571360rvfuPX','\x0a\x0aAnalyze\x20the\x20user\x27s\x20prompt\x20and\x20determine\x20the\x20most\x20appropriate\x20command(s)\x20to\x20run.\x0a-\x20If\x20a\x20command\x20needs\x20arguments,\x20extract\x20them\x20from\x20the\x20prompt.\x0a-\x20Understand\x20the\x20users\x20prompt\x20first\x20and\x20command\x20argument.\x20Don\x27t\x20just\x20use\x20the\x20users\x20prompt\x20word\x20for\x20word\x0a-\x20If\x20the\x20prompt\x20is\x20just\x20a\x20greeting\x20or\x20a\x20general\x20chat\x20message,\x20return\x20an\x20empty\x20\x22commands\x22\x20array.\x0a-\x20Do\x20not\x20try\x20to\x20run\x20commands\x20that\x20are\x20not\x20on\x20the\x20list.\x0a-\x20If\x20the\x20user\x20asks\x20for\x20something\x20that\x20requires\x20a\x20command,\x20but\x20doesn\x27t\x20provide\x20the\x20necessary\x20arguments\x20(e.g.,\x20\x22.weather\x22),\x20ask\x20them\x20for\x20the\x20missing\x20information\x20in\x20your\x20\x22decision\x22\x20and\x20return\x20an\x20empty\x20\x22commands\x22\x20array.\x0a-\x20If\x20a\x20user\x20mentions\x20another\x20user\x20for\x20example\x20@2349134622805\x20You\x20can\x20also\x20mention\x20the\x20user\x20as\x20well\x20using\x20the\x20same\x20format.\x20Tell\x20this\x20to\x20your\x20next\x20layer\x0a-\x20If\x20the\x20user\x20asks\x20or\x20responds\x20to\x20something\x20in\x20the\x20recent\x20conversation\x20history,\x20your\x20response\x20decision\x20should\x20be\x20detailed\x20because\x20your\x20remix\x20layer\x20has\x20no\x20access\x20to\x20the\x20previuos\x20memory\x20and\x20so\x20it\x20knows\x20what\x20the\x20context\x20is\x20exactly.\x0a-\x20Make\x20your\x20decision\x20very\x20detailed\x20because\x20you\x20are\x20the\x20brain\x20of\x20a\x20system\x20and\x20other\x20components\x20won\x27t\x20work\x20well\x20if\x20the\x20brain\x20provides\x20very\x20little\x20or\x20insufficient\x20information\x0a\x0aOther\x20information:\x0a-\x20Your\x20maker/developer\x20is\x20Dtechy,\x20his\x20number\x20is\x202349134622805,\x20JID/ID:\x202349134622805@s.whatsapp.net\x0a-\x20Your\x20name\x20is\x20mora\x0a-\x20Your\x20current\x20user\x20is\x20','parse','start','217955uIvgQz','3929254bUhMQs','conversation','commands','stringify','usage','Command\x20execution\x20finished','join','name','\x0a\x20\x20You\x20are\x20Mora,\x20a\x20smart,\x20witty\x20Gen\x20Z\x20assistant.\x0aYour\x20personality\x20is\x20helpful,\x20a\x20little\x20sassy,\x20and\x20you\x20use\x20modern\x20slang.\x0aBased\x20on\x20the\x20following\x20information,\x20craft\x20a\x20response\x20to\x20the\x20user.\x0a\x0a---\x0aOriginal\x20User\x20Prompt:\x20\x22','quotedMessage',',\x20JID/ID:\x20','contextInfo'];a0_0x129e=function(){return _0x4c5dfd;};return a0_0x129e();}(function(_0x1cc014,_0x2cb34d){const _0x223746=a0_0xc8a3,_0xf4b3b0=_0x1cc014();while(!![]){try{const _0x565a5e=-parseInt(_0x223746(0x134))/0x1+-parseInt(_0x223746(0x150))/0x2*(-parseInt(_0x223746(0x179))/0x3)+-parseInt(_0x223746(0x126))/0x4+-parseInt(_0x223746(0x12c))/0x5*(parseInt(_0x223746(0x17a))/0x6)+parseInt(_0x223746(0x135))/0x7+parseInt(_0x223746(0x130))/0x8+parseInt(_0x223746(0x158))/0x9*(parseInt(_0x223746(0x16e))/0xa);if(_0x565a5e===_0x2cb34d)break;else _0xf4b3b0['push'](_0xf4b3b0['shift']());}catch(_0x68de8e){_0xf4b3b0['push'](_0xf4b3b0['shift']());}}}(a0_0x129e,0x61895));const {GoogleGenerativeAI}=require(a0_0x1213e9(0x166)),{getCommandMap}=require('./index'),{executeAiCommand}=require(a0_0x1213e9(0x11d)),{StatusUpdater}=require(a0_0x1213e9(0x122)),{loadMemory,saveMemory}=require(a0_0x1213e9(0x12a)),lidToJid=require(a0_0x1213e9(0x169)),normalizeMentions=require(a0_0x1213e9(0x16a)),logger={'info':(_0x5b4a27,_0x1d128d)=>console[a0_0x1213e9(0x177)](a0_0x1213e9(0x176)+_0x1d128d,_0x5b4a27),'error':(_0x1ad573,_0x235c2b)=>console[a0_0x1213e9(0x145)]('[ERROR]\x20'+_0x235c2b,_0x1ad573)},genAI=new GoogleGenerativeAI(a0_0x1213e9(0x120));module[a0_0x1213e9(0x16b)]={'meta':{'name':'ai','description':a0_0x1213e9(0x14b),'usage':'.ai\x20<prompt>','category':'AI','ownerOnly':![],'ai':![],'args':[{'name':a0_0x1213e9(0x171),'required':!![],'greedy':!![],'description':a0_0x1213e9(0x155)}]},'run':async({m:_0x370644,sock:_0x1ca9a1,args:_0x29ed43,flags:_0x140ad7,executeCommand:_0x17a05c,metadata:_0x301e53})=>{const _0x58b950=a0_0x1213e9,_0x4b7de4=_0x370644[_0x58b950(0x144)][_0x58b950(0x149)],_0x2cc5e6=_0x370644[_0x58b950(0x144)][_0x58b950(0x152)]||_0x4b7de4,_0x221570=_0x370644[_0x58b950(0x161)]||null;let _0x2268df=[],_0x2f15d1=_0x29ed43[_0x58b950(0x171)];if(_0x4b7de4[_0x58b950(0x16d)]('@g.us')&&_0x370644[_0x58b950(0x11e)]?.[_0x58b950(0x11f)]?.['contextInfo']?.[_0x58b950(0x174)]){const _0x3957ec=_0x370644[_0x58b950(0x11e)][_0x58b950(0x11f)][_0x58b950(0x140)][_0x58b950(0x174)];console['log'](_0x58b950(0x151),_0x3957ec);const {normalizedText:_0x42a0d5,mentions:_0x1e9759}=await normalizeMentions(_0x2f15d1,_0x3957ec,_0x301e53,lidToJid);_0x2f15d1=_0x42a0d5,_0x2268df=_0x1e9759;}logger[_0x58b950(0x11b)]({'user':_0x370644['pushName'],'prompt':_0x2f15d1},_0x58b950(0x17b));const _0x1ad8c8=new StatusUpdater(_0x1ca9a1,_0x4b7de4);await _0x1ad8c8[_0x58b950(0x133)]();try{const _0x2b1b26=await loadMemory(_0x4b7de4,_0x2cc5e6);logger[_0x58b950(0x11b)]({},'Entering\x20Thinking\x20Layer...'),await _0x1ad8c8[_0x58b950(0x123)]('🤔\x20Thinking....');const _0x5db4a3=await thinkingLayer(_0x2f15d1,_0x2b1b26,_0x370644,_0x301e53);logger[_0x58b950(0x11b)](_0x5db4a3,_0x58b950(0x178)),logger[_0x58b950(0x11b)]({'prompt':_0x2f15d1,'decision':_0x5db4a3[_0x58b950(0x14f)],'commandsToRun':_0x5db4a3['commands']},'AI\x20Thinking\x20Layer\x20Processed');let _0x28f369=[];if(_0x5db4a3[_0x58b950(0x137)]&&_0x5db4a3['commands'][_0x58b950(0x165)]>0x0){logger[_0x58b950(0x11b)]({'commands':_0x5db4a3[_0x58b950(0x137)]},_0x58b950(0x12e)),await _0x1ad8c8[_0x58b950(0x123)](_0x58b950(0x15e)+_0x5db4a3[_0x58b950(0x137)][_0x58b950(0x13b)](',\x20')+_0x58b950(0x163));for(const _0x47b915 of _0x5db4a3['commands']){logger[_0x58b950(0x11b)]({'commandString':_0x47b915},'Executing\x20command');const _0x3456ad=_0x47b915[_0x58b950(0x15c)]()[_0x58b950(0x15f)](/\s+/);_0x3456ad[0x0]=_0x3456ad[0x0][_0x58b950(0x146)](0x1);const _0x57b98a=_0x3456ad[0x0],_0x2ed482=await executeAiCommand({'m':_0x370644,'sock':_0x1ca9a1,'tokens':['!'+_0x57b98a,..._0x3456ad[_0x58b950(0x146)](0x1)],'metadata':_0x301e53});_0x2ed482&&_0x2ed482['type']!==_0x58b950(0x15d)&&(logger[_0x58b950(0x11b)]({'command':_0x57b98a,'type':_0x2ed482[_0x58b950(0x11a)]},_0x58b950(0x148)),await _0x1ca9a1['sendMessage'](_0x370644['key']['remoteJid'],_0x2ed482['raw'])),_0x28f369[_0x58b950(0x14c)]({'command':_0x57b98a,'type':_0x2ed482[_0x58b950(0x11a)],'output':_0x2ed482[_0x58b950(0x16c)]||_0x2ed482[_0x58b950(0x15d)]}),logger[_0x58b950(0x11b)]({'command':_0x57b98a,'output':_0x2ed482},_0x58b950(0x13a));}}else logger[_0x58b950(0x11b)]({},_0x58b950(0x162));logger[_0x58b950(0x11b)]({},_0x58b950(0x173));const _0x430ab5={'prompt':_0x2f15d1,'decision':_0x5db4a3[_0x58b950(0x14f)],'commandOutputs':_0x28f369};logger[_0x58b950(0x11b)]({'context':_0x430ab5},'Remix\x20Layer\x20context');const _0x4d64cc=await remixLayer(_0x430ab5,_0x370644);logger['info']({'finalResponse':_0x4d64cc},_0x58b950(0x142));const _0x2c01b8=await extractJidsFromText(_0x4d64cc,_0x301e53),_0x13c4f9=Array['from'](new Set([..._0x2268df,..._0x2c01b8]));await saveMemory(_0x4b7de4,_0x2cc5e6,_0x2f15d1,_0x4d64cc,_0x221570,_0x28f369,_0x13c4f9),await _0x1ad8c8[_0x58b950(0x15b)]({'text':_0x4d64cc,'mentions':_0x13c4f9});}catch(_0x3b266a){logger['error'](_0x3b266a,_0x58b950(0x127)),await _0x1ad8c8[_0x58b950(0x15b)](_0x58b950(0x172));}}};function extractJidsFromText(_0x2eb61f,_0x3b72b2){const _0x2c2377=a0_0x1213e9,_0x3c8e01=/@[0-9]+/g,_0x211dfd=/[0-9]+@s\.whatsapp\.net/g,_0x30bbfd=[..._0x2eb61f[_0x2c2377(0x15a)](_0x3c8e01)||[],..._0x2eb61f[_0x2c2377(0x15a)](_0x211dfd)||[]];return Promise[_0x2c2377(0x11c)](_0x30bbfd['map'](_0x12e64c=>lidToJid(_0x12e64c,_0x3b72b2)));}function a0_0xc8a3(_0x371b3c,_0x2e28fd){const _0x129e7b=a0_0x129e();return a0_0xc8a3=function(_0xc8a384,_0x4d86a5){_0xc8a384=_0xc8a384-0x11a;let _0x1ebcb4=_0x129e7b[_0xc8a384];return _0x1ebcb4;},a0_0xc8a3(_0x371b3c,_0x2e28fd);}async function thinkingLayer(_0xad837c,_0x5d920a,_0x528cc5,_0x510299){const _0x24368c=a0_0x1213e9;logger[_0x24368c(0x11b)]({'prompt':_0xad837c},_0x24368c(0x121));const _0x7da14e=genAI['getGenerativeModel']({'model':_0x24368c(0x14a)}),_0x177030=getCommandMap(),_0x2c6dda=Array['from'](_0x177030[_0x24368c(0x128)]())[_0x24368c(0x157)](_0x1b47fe=>_0x1b47fe[_0x24368c(0x160)]['ai']!==![])[_0x24368c(0x164)](_0x5e6710=>({'name':_0x5e6710[_0x24368c(0x160)][_0x24368c(0x13c)],'description':_0x5e6710[_0x24368c(0x160)][_0x24368c(0x156)],'usage':_0x5e6710[_0x24368c(0x160)][_0x24368c(0x139)],'direct':_0x5e6710[_0x24368c(0x160)][_0x24368c(0x129)]||![],'args':(_0x5e6710[_0x24368c(0x160)][_0x24368c(0x124)]||[])[_0x24368c(0x164)](_0x527597=>_0x527597[_0x24368c(0x13c)]+'\x20('+_0x527597[_0x24368c(0x156)]+')')[_0x24368c(0x13b)](',\x20')})),_0xc28835=_0x24368c(0x12b)+JSON['stringify'](_0x5d920a,null,0x2)+'\x0a\x0aHere\x20are\x20the\x20available\x20commands\x20you\x20can\x20use:\x0a'+JSON[_0x24368c(0x138)](_0x2c6dda,null,0x2)+_0x24368c(0x143)+(_0x528cc5[_0x24368c(0x11e)][_0x24368c(0x11f)]?.[_0x24368c(0x140)]?.[_0x24368c(0x13e)]?.[_0x24368c(0x136)]||_0x24368c(0x12d))+_0x24368c(0x131)+_0x528cc5[_0x24368c(0x161)]+_0x24368c(0x13f)+(_0x528cc5[_0x24368c(0x144)][_0x24368c(0x152)]||_0x528cc5[_0x24368c(0x144)][_0x24368c(0x149)])+_0x24368c(0x141)+_0xad837c+'\x22\x0a';try{const _0x3ef0ef=await _0x7da14e[_0x24368c(0x154)](_0xc28835),_0x5b8a82=await _0x3ef0ef[_0x24368c(0x170)][_0x24368c(0x15d)](),_0x1d15dd=_0x5b8a82[_0x24368c(0x153)](/```json/g,'')['replace'](/```/g,'')[_0x24368c(0x15c)]();if(!_0x1d15dd['includes']('{'))return{'decision':'I\x20couldn\x27t\x20figure\x20out\x20what\x20to\x20do.','commands':[]};const _0xa5233b=JSON[_0x24368c(0x132)](_0x1d15dd);return{'decision':_0xa5233b[_0x24368c(0x14f)],'commands':_0xa5233b['commands']||[]};}catch(_0x2dc458){return logger[_0x24368c(0x145)](_0x2dc458,'Error\x20in\x20Gemini\x20Thinking\x20Layer'),{'decision':'There\x20was\x20an\x20error\x20in\x20my\x20thinking\x20process.','commands':[]};}}async function remixLayer(_0x56d0f6,_0x1a6777){const _0x129ee2=a0_0x1213e9;logger[_0x129ee2(0x11b)]({'context':_0x56d0f6},_0x129ee2(0x168));const _0x25c4ad=genAI[_0x129ee2(0x159)]({'model':_0x129ee2(0x14a)}),_0xb25b21=_0x56d0f6[_0x129ee2(0x167)][_0x129ee2(0x164)](_0x49efbe=>'-\x20'+_0x49efbe['command']+':\x20'+_0x49efbe[_0x129ee2(0x12f)])['join']('\x0a'),_0x5a6783=_0x129ee2(0x13d)+_0x56d0f6[_0x129ee2(0x171)]+_0x129ee2(0x16f)+_0x56d0f6['decision']+_0x129ee2(0x147)+(_0xb25b21||_0x129ee2(0x12d))+_0x129ee2(0x14d)+_0x1a6777[_0x129ee2(0x161)]+_0x129ee2(0x13f)+(_0x1a6777[_0x129ee2(0x144)][_0x129ee2(0x152)]||_0x1a6777['key'][_0x129ee2(0x149)])+'\x0a';try{const _0x524504=await _0x25c4ad[_0x129ee2(0x154)](_0x5a6783),_0x34c1e1=_0x524504[_0x129ee2(0x170)][_0x129ee2(0x15d)]()?.['trim']();return _0x34c1e1||_0x129ee2(0x14e);}catch(_0x5c8224){return logger[_0x129ee2(0x145)](_0x5c8224,_0x129ee2(0x125)),_0x129ee2(0x175);}}