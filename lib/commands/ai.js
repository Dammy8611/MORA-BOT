const a0_0x150142=a0_0x412e;(function(_0x5105a4,_0x5f074c){const _0xde81f7=a0_0x412e,_0x1948a0=_0x5105a4();while(!![]){try{const _0x40edb8=-parseInt(_0xde81f7(0x1c8))/0x1*(parseInt(_0xde81f7(0x1af))/0x2)+parseInt(_0xde81f7(0x196))/0x3+parseInt(_0xde81f7(0x1ae))/0x4*(-parseInt(_0xde81f7(0x1d4))/0x5)+-parseInt(_0xde81f7(0x19e))/0x6+parseInt(_0xde81f7(0x1d3))/0x7+-parseInt(_0xde81f7(0x1b9))/0x8*(-parseInt(_0xde81f7(0x1c2))/0x9)+parseInt(_0xde81f7(0x1d7))/0xa;if(_0x40edb8===_0x5f074c)break;else _0x1948a0['push'](_0x1948a0['shift']());}catch(_0x3c577c){_0x1948a0['push'](_0x1948a0['shift']());}}}(a0_0x3f2f,0x7fc4f));function a0_0x3f2f(){const _0x346de9=['6518iDbOAT','decision','pushName','No\x20commands\x20to\x20execute.','Entering\x20Thinking\x20Layer...','error','Command\x20returned\x20media.\x20Sending\x20directly.','AIzaSyCHDhotAUDVO7xV0C9jgJFTyf5NJYOItOo','key','../../utils/lidToJid.js','348744YdXkAJ','A\x20friendly\x20AI\x20assistant\x20named\x20Mora.','prompt','response','Remix\x20Layer\x20context','includes','AI\x20command\x20invoked','../core/executeCommand','length','198WLUusk','getGenerativeModel','../../utils/statusUpdater.js','extendedTextMessage','generateContent','Entering\x20Remix\x20Layer...','83ffHuKH','Running\x20command(s):\x20','remoteJid','commands','info','\x0aYou\x20are\x20the\x20\x22Thinking\x20Layer\x22\x20for\x20a\x20bot\x20named\x20Mora.\x20Your\x20job\x20is\x20to\x20analyze\x20a\x20user\x27s\x20prompt\x20and\x20decide\x20which,\x20if\x20any,\x20of\x20the\x20available\x20commands\x20should\x20be\x20executed.\x0a\x0aYou\x20must\x20respond\x20in\x20a\x20JSON\x20format\x20with\x20two\x20properties:\x0a1.\x20\x22decision\x22:\x20A\x20string\x20explaining\x20your\x20reasoning.\x0a2.\x20\x22commands\x22:\x20An\x20array\x20of\x20strings,\x20where\x20each\x20string\x20is\x20the\x20full\x20command\x20to\x20execute\x20(e.g.,\x20\x22.weather\x20London\x22).\x0a\x0aHere\x20is\x20the\x20recent\x20conversation\x20history\x20(if\x20any):\x0a','🤔\x20Thinking....','\x0a\x0aHere\x20are\x20the\x20available\x20commands\x20you\x20can\x20use:\x0a','type','There\x20was\x20an\x20error\x20in\x20my\x20thinking\x20process.','direct','3180156kOYTvf','3169205eiwGcW','I\x27m\x20a\x20bit\x20flustered\x20rn\x20😵‍💫','values','1531590YJgvjd','@g.us','output','placeholder','text','conversation','I\x20couldn\x27t\x20figure\x20out\x20what\x20to\x20do.','Error\x20in\x20Remix\x20Layer','\x22\x0aCommands\x20I\x20ran\x20and\x20their\x20output:\x0a','done','update','\x0a\x0aUser\x20Prompt:\x20\x22','match','mentionedJid',',\x20JID/ID:\x20','trim','exports','description','Thinking\x20Layer\x20finished','\x0a\x0aAnalyze\x20the\x20user\x27s\x20prompt\x20and\x20determine\x20the\x20most\x20appropriate\x20command(s)\x20to\x20run.\x0a-\x20If\x20a\x20command\x20needs\x20arguments,\x20extract\x20them\x20from\x20the\x20prompt.\x0a-\x20Understand\x20the\x20users\x20prompt\x20first\x20and\x20command\x20argument.\x20Don\x27t\x20just\x20use\x20the\x20users\x20prompt\x20word\x20for\x20word\x0a-\x20If\x20the\x20prompt\x20is\x20just\x20a\x20greeting\x20or\x20a\x20general\x20chat\x20message,\x20return\x20an\x20empty\x20\x22commands\x22\x20array.\x0a-\x20Do\x20not\x20try\x20to\x20run\x20commands\x20that\x20are\x20not\x20on\x20the\x20list.\x0a-\x20If\x20the\x20user\x20asks\x20for\x20something\x20that\x20requires\x20a\x20command,\x20but\x20doesn\x27t\x20provide\x20the\x20necessary\x20arguments\x20(e.g.,\x20\x22.weather\x22),\x20ask\x20them\x20for\x20the\x20missing\x20information\x20in\x20your\x20\x22decision\x22\x20and\x20return\x20an\x20empty\x20\x22commands\x22\x20array.\x0a-\x20If\x20a\x20user\x20mentions\x20another\x20user\x20for\x20example\x20@2349134622805\x20You\x20can\x20also\x20mention\x20the\x20user\x20as\x20well\x20using\x20the\x20same\x20format.\x20Tell\x20this\x20to\x20your\x20next\x20layer\x0a-\x20If\x20the\x20user\x20asks\x20or\x20responds\x20to\x20something\x20in\x20the\x20recent\x20conversation\x20history,\x20your\x20response\x20decision\x20should\x20be\x20detailed\x20because\x20your\x20remix\x20layer\x20has\x20no\x20access\x20to\x20the\x20previuos\x20memory\x20and\x20so\x20it\x20knows\x20what\x20the\x20context\x20is\x20exactly.\x0a-\x20Make\x20your\x20decision\x20very\x20detailed\x20because\x20you\x20are\x20the\x20brain\x20of\x20a\x20system\x20and\x20other\x20components\x20won\x27t\x20work\x20well\x20if\x20the\x20brain\x20provides\x20very\x20little\x20or\x20insufficient\x20information\x0a\x0aOther\x20information:\x0a-\x20Your\x20maker/developer\x20is\x20Dtechy,\x20his\x20number\x20is\x202349134622805,\x20JID/ID:\x202349134622805@s.whatsapp.net\x0a-\x20Your\x20name\x20is\x20mora\x0a-\x20Your\x20current\x20user\x20is\x20','slice','log','None','Entering\x20Command\x20Execution\x20phase','Remix\x20Layer\x20received\x20context.','join','name','AI\x20Thinking\x20Layer\x20Processed','participant','807258yEOEQF','Here\x20you\x20go\x20✨','parse','AI\x20command\x20failed','./index','contextInfo','\x0a\x0aMessage\x20reply\x20(if\x20any).\x20If\x20null\x20then\x20reply\x20is\x20an\x20image\x20or\x20video\x20you\x20can\x27t\x20see\x20those\x20yet:\x0a','The\x20prompt\x20for\x20the\x20AI.','2447508ozDLOB','message','Remix\x20Layer\x20finished','map','sendMessage','Error\x20in\x20Gemini\x20Thinking\x20Layer','[INFO]\x20','@google/generative-ai','command','from','meta','endsWith','\x0a---\x0a\x0aYour\x20response\x20should\x20be\x20natural\x20and\x20conversational.\x20Don\x27t\x20just\x20state\x20the\x20facts,\x20remix\x20them\x20into\x20a\x20proper\x20answer.\x0aMake\x20your\x20responses\x20short\x20and\x20concise\x20like\x20you\x20are\x20talking\x20to\x20a\x20friend\x0aDont\x20make\x20refrences\x20to\x20your\x20thinking\x20layer,\x20your\x20output\x20should\x20be\x20as\x20though\x20you\x20already\x20know\x20it\x0a\x0aOther\x20information:\x0a-\x20If\x20a\x20user\x20mentions\x20another\x20user\x20for\x20example\x20@2349134622805\x20You\x20can\x20also\x20mention\x20the\x20user\x20as\x20well\x20using\x20the\x20same\x20format.\x0a-\x20Your\x20maker/developer\x20is\x20Dtechy,\x20his\x20number\x20is\x202349134622805,\x20JID/ID:\x202349134622805@s.whatsapp.net\x0a-\x20Your\x20name\x20is\x20mora\x0a-\x20Your\x20current\x20user\x20is\x20','stringify','commandOutputs','Executing\x20command','4egBiQH'];a0_0x3f2f=function(){return _0x346de9;};return a0_0x3f2f();}const {GoogleGenerativeAI}=require(a0_0x150142(0x1a5)),{getCommandMap}=require(a0_0x150142(0x19a)),{executeAiCommand}=require(a0_0x150142(0x1c0)),{StatusUpdater}=require(a0_0x150142(0x1c4)),{loadMemory,saveMemory}=require('../memory.js'),lidToJid=require(a0_0x150142(0x1b8)),normalizeMentions=require('../../utils/normalize.js'),logger={'info':(_0x47e99f,_0x50dca4)=>console[a0_0x150142(0x1ec)](a0_0x150142(0x1a4)+_0x50dca4,_0x47e99f),'error':(_0x105c6d,_0x1378a3)=>console[a0_0x150142(0x1b4)]('[ERROR]\x20'+_0x1378a3,_0x105c6d)},genAI=new GoogleGenerativeAI(a0_0x150142(0x1b6));module[a0_0x150142(0x1e7)]={'meta':{'name':'ai','description':a0_0x150142(0x1ba),'usage':'.ai\x20<prompt>','category':'AI','ownerOnly':![],'ai':![],'args':[{'name':a0_0x150142(0x1bb),'required':!![],'greedy':!![],'description':a0_0x150142(0x19d)}]},'run':async({m:_0x226fdb,sock:_0x40f8c6,args:_0x521d45,flags:_0x2a0043,executeCommand:_0x278b07,metadata:_0x5e08ce})=>{const _0x2850ec=a0_0x150142,_0x2a2424=_0x226fdb['key'][_0x2850ec(0x1ca)],_0x2ff345=_0x226fdb[_0x2850ec(0x1b7)]['participant']||_0x2a2424,_0x426880=_0x226fdb['pushName']||null;let _0x104a7d=[],_0x3b464b=_0x521d45['prompt'];if(_0x2a2424[_0x2850ec(0x1a9)](_0x2850ec(0x1d8))&&_0x226fdb['message']?.['extendedTextMessage']?.[_0x2850ec(0x19b)]?.[_0x2850ec(0x1e4)]){const _0x3f3ba7=_0x226fdb[_0x2850ec(0x19f)]['extendedTextMessage']['contextInfo'][_0x2850ec(0x1e4)];console[_0x2850ec(0x1ec)]('Raw\x20lids:',_0x3f3ba7);const {normalizedText:_0x5c4f91,mentions:_0x22e57e}=await normalizeMentions(_0x3b464b,_0x3f3ba7,_0x5e08ce,lidToJid);_0x3b464b=_0x5c4f91,_0x104a7d=_0x22e57e;}logger[_0x2850ec(0x1cc)]({'user':_0x226fdb[_0x2850ec(0x1b1)],'prompt':_0x3b464b},_0x2850ec(0x1bf));const _0x2192ac=new StatusUpdater(_0x40f8c6,_0x2a2424);await _0x2192ac['start']();try{const _0x1267c7=await loadMemory(_0x2a2424,_0x2ff345);logger[_0x2850ec(0x1cc)]({},_0x2850ec(0x1b3)),await _0x2192ac[_0x2850ec(0x1e1)](_0x2850ec(0x1ce));const _0x34540e=await thinkingLayer(_0x3b464b,_0x1267c7,_0x226fdb,_0x5e08ce);logger[_0x2850ec(0x1cc)](_0x34540e,_0x2850ec(0x1e9)),logger[_0x2850ec(0x1cc)]({'prompt':_0x3b464b,'decision':_0x34540e[_0x2850ec(0x1b0)],'commandsToRun':_0x34540e['commands']},_0x2850ec(0x194));let _0x2d11ba=[];if(_0x34540e[_0x2850ec(0x1cb)]&&_0x34540e[_0x2850ec(0x1cb)][_0x2850ec(0x1c1)]>0x0){logger[_0x2850ec(0x1cc)]({'commands':_0x34540e[_0x2850ec(0x1cb)]},_0x2850ec(0x1ee)),await _0x2192ac[_0x2850ec(0x1e1)](_0x2850ec(0x1c9)+_0x34540e[_0x2850ec(0x1cb)][_0x2850ec(0x192)](',\x20')+'...');for(const _0x182861 of _0x34540e[_0x2850ec(0x1cb)]){logger[_0x2850ec(0x1cc)]({'commandString':_0x182861},_0x2850ec(0x1ad));const _0x41657a=_0x182861[_0x2850ec(0x1e6)]()['split'](/\s+/);_0x41657a[0x0]=_0x41657a[0x0]['slice'](0x1);const _0x2548ab=_0x41657a[0x0],_0x45423b=await executeAiCommand({'m':_0x226fdb,'sock':_0x40f8c6,'tokens':['!'+_0x2548ab,..._0x41657a[_0x2850ec(0x1eb)](0x1)],'metadata':_0x5e08ce});_0x45423b&&_0x45423b[_0x2850ec(0x1d0)]!==_0x2850ec(0x1db)&&(logger[_0x2850ec(0x1cc)]({'command':_0x2548ab,'type':_0x45423b[_0x2850ec(0x1d0)]},_0x2850ec(0x1b5)),await _0x40f8c6[_0x2850ec(0x1a2)](_0x226fdb['key'][_0x2850ec(0x1ca)],_0x45423b['raw'])),_0x2d11ba['push']({'command':_0x2548ab,'type':_0x45423b['type'],'output':_0x45423b[_0x2850ec(0x1da)]||_0x45423b[_0x2850ec(0x1db)]}),logger[_0x2850ec(0x1cc)]({'command':_0x2548ab,'output':_0x45423b},'Command\x20execution\x20finished');}}else logger[_0x2850ec(0x1cc)]({},_0x2850ec(0x1b2));logger[_0x2850ec(0x1cc)]({},_0x2850ec(0x1c7));const _0x4723ca={'prompt':_0x3b464b,'decision':_0x34540e[_0x2850ec(0x1b0)],'commandOutputs':_0x2d11ba};logger[_0x2850ec(0x1cc)]({'context':_0x4723ca},_0x2850ec(0x1bd));const _0x79aec7=await remixLayer(_0x4723ca,_0x226fdb);logger[_0x2850ec(0x1cc)]({'finalResponse':_0x79aec7},_0x2850ec(0x1a0));const _0x1f3db8=await extractJidsFromText(_0x79aec7,_0x5e08ce),_0x3716e8=Array['from'](new Set([..._0x104a7d,..._0x1f3db8]));await saveMemory(_0x2a2424,_0x2ff345,_0x3b464b,_0x79aec7,_0x426880,_0x2d11ba,_0x3716e8),await _0x2192ac[_0x2850ec(0x1e0)]({'text':_0x79aec7,'mentions':_0x3716e8});}catch(_0x5e21ea){logger[_0x2850ec(0x1b4)](_0x5e21ea,_0x2850ec(0x199)),await _0x2192ac[_0x2850ec(0x1e0)]('Sorry,\x20something\x20went\x20wrong\x20with\x20my\x20circuits.\x20😵‍💫');}}};function a0_0x412e(_0x5e339e,_0x119ec9){const _0x3f2fea=a0_0x3f2f();return a0_0x412e=function(_0x412e2d,_0x214355){_0x412e2d=_0x412e2d-0x192;let _0x37002a=_0x3f2fea[_0x412e2d];return _0x37002a;},a0_0x412e(_0x5e339e,_0x119ec9);}function extractJidsFromText(_0x487ac9,_0x2bed88){const _0x1da431=a0_0x150142,_0xf5fa9=/@[0-9]+/g,_0x369b68=/[0-9]+@s\.whatsapp\.net/g,_0x1fb4fa=[..._0x487ac9[_0x1da431(0x1e3)](_0xf5fa9)||[],..._0x487ac9[_0x1da431(0x1e3)](_0x369b68)||[]];return Promise['all'](_0x1fb4fa[_0x1da431(0x1a1)](_0xed47ac=>lidToJid(_0xed47ac,_0x2bed88)));}async function thinkingLayer(_0x332f59,_0x2b2f02,_0x1ab899,_0x4d48ed){const _0x4e28f5=a0_0x150142;logger[_0x4e28f5(0x1cc)]({'prompt':_0x332f59},'Thinking\x20Layer\x20received\x20prompt.');const _0x209bd5=genAI[_0x4e28f5(0x1c3)]({'model':'gemini-2.5-flash'}),_0xfc5342=getCommandMap(),_0x1cb046=Array[_0x4e28f5(0x1a7)](_0xfc5342[_0x4e28f5(0x1d6)]())['filter'](_0x2610e4=>_0x2610e4[_0x4e28f5(0x1a8)]['ai']!==![])[_0x4e28f5(0x1a1)](_0x1b4653=>({'name':_0x1b4653[_0x4e28f5(0x1a8)][_0x4e28f5(0x193)],'description':_0x1b4653['meta']['description'],'usage':_0x1b4653['meta']['usage'],'direct':_0x1b4653[_0x4e28f5(0x1a8)][_0x4e28f5(0x1d2)]||![],'args':(_0x1b4653['meta']['args']||[])['map'](_0x13439b=>_0x13439b[_0x4e28f5(0x193)]+'\x20('+_0x13439b[_0x4e28f5(0x1e8)]+')')[_0x4e28f5(0x192)](',\x20')})),_0x36f42f=_0x4e28f5(0x1cd)+JSON[_0x4e28f5(0x1ab)](_0x2b2f02,null,0x2)+_0x4e28f5(0x1cf)+JSON[_0x4e28f5(0x1ab)](_0x1cb046,null,0x2)+_0x4e28f5(0x19c)+(_0x1ab899[_0x4e28f5(0x19f)][_0x4e28f5(0x1c5)]?.[_0x4e28f5(0x19b)]?.['quotedMessage']?.[_0x4e28f5(0x1dc)]||_0x4e28f5(0x1ed))+_0x4e28f5(0x1ea)+_0x1ab899[_0x4e28f5(0x1b1)]+_0x4e28f5(0x1e5)+(_0x1ab899[_0x4e28f5(0x1b7)]['participant']||_0x1ab899[_0x4e28f5(0x1b7)]['remoteJid'])+_0x4e28f5(0x1e2)+_0x332f59+'\x22\x0a';try{const _0x50ebd9=await _0x209bd5['generateContent'](_0x36f42f),_0x414790=await _0x50ebd9[_0x4e28f5(0x1bc)][_0x4e28f5(0x1db)](),_0x4ce94d=_0x414790['replace'](/```json/g,'')['replace'](/```/g,'')['trim']();if(!_0x4ce94d[_0x4e28f5(0x1be)]('{'))return{'decision':_0x4e28f5(0x1dd),'commands':[]};const _0x175247=JSON[_0x4e28f5(0x198)](_0x4ce94d);return{'decision':_0x175247[_0x4e28f5(0x1b0)],'commands':_0x175247[_0x4e28f5(0x1cb)]||[]};}catch(_0x11298d){return logger[_0x4e28f5(0x1b4)](_0x11298d,_0x4e28f5(0x1a3)),{'decision':_0x4e28f5(0x1d1),'commands':[]};}}async function remixLayer(_0x19bbba,_0x58215e){const _0xc3d664=a0_0x150142;logger[_0xc3d664(0x1cc)]({'context':_0x19bbba},_0xc3d664(0x1ef));const _0x34ab26=genAI[_0xc3d664(0x1c3)]({'model':'gemini-2.5-flash'}),_0x128505=_0x19bbba[_0xc3d664(0x1ac)][_0xc3d664(0x1a1)](_0x40fbec=>'-\x20'+_0x40fbec[_0xc3d664(0x1a6)]+':\x20'+_0x40fbec[_0xc3d664(0x1d9)])[_0xc3d664(0x192)]('\x0a'),_0x17e9da='\x0a\x20\x20You\x20are\x20Mora,\x20a\x20smart,\x20witty\x20Gen\x20Z\x20assistant.\x0aYour\x20personality\x20is\x20helpful,\x20a\x20little\x20sassy,\x20and\x20you\x20use\x20modern\x20slang.\x0aBased\x20on\x20the\x20following\x20information,\x20craft\x20a\x20response\x20to\x20the\x20user.\x0a\x0a---\x0aOriginal\x20User\x20Prompt:\x20\x22'+_0x19bbba[_0xc3d664(0x1bb)]+'\x22\x0aMy\x20internal\x20thought\x20process:\x20\x22'+_0x19bbba[_0xc3d664(0x1b0)]+_0xc3d664(0x1df)+(_0x128505||_0xc3d664(0x1ed))+_0xc3d664(0x1aa)+_0x58215e[_0xc3d664(0x1b1)]+_0xc3d664(0x1e5)+(_0x58215e[_0xc3d664(0x1b7)][_0xc3d664(0x195)]||_0x58215e['key']['remoteJid'])+'\x0a';try{const _0x4b1570=await _0x34ab26[_0xc3d664(0x1c6)](_0x17e9da),_0x9f7ab3=_0x4b1570[_0xc3d664(0x1bc)]['text']()?.[_0xc3d664(0x1e6)]();return _0x9f7ab3||_0xc3d664(0x197);}catch(_0x509b08){return logger[_0xc3d664(0x1b4)](_0x509b08,_0xc3d664(0x1de)),_0xc3d664(0x1d5);}}